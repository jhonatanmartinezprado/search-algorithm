Array.prototype.indexOf||(Array.prototype.indexOf=function(a,c){var d=this.length,b=Number(c)||0,b=0>b?Math.ceil(b):Math.floor(b);for(0>b&&(b+=d);b<d;++b)if(b in this&&this[b]===a)return b;return-1});Array.prototype.remove||(Array.prototype.remove=function(a,c){var d=this.slice((c||a)+1||this.length);this.length=0>a?this.length+a:a;return this.push.apply(this,d)});var GraphNodeType={OPEN:0,WALL:1};
function Graph(a){this.elements=a;for(var c=[],d,b,e=a.length,f=0;f<e;++f){d=a[f];b=d.length;c[f]=Array(b);for(var g=0;g<b;++g)c[f][g]=new GraphNode(f,g,d[g])}this.nodes=c}Graph.prototype.toString=function(){for(var a="\n",c=this.nodes,d,b,e,f,g=0,i=c.length;g<i;){d="";b=c[g++];for(e=0,f=b.length;e<f;)d+=b[e++].type+" ";a=a+d+"\n"}return a};function GraphNode(a,c,d){this.data={};this.x=a;this.y=c;this.pos={x:a,y:c};this.type=d}GraphNode.prototype.toString=function(){return"["+this.x+" "+this.y+"]"};
GraphNode.prototype.isWall=function(){return this.type==GraphNodeType.WALL};function BinaryHeap(a){this.content=[];this.scoreFunction=a}
BinaryHeap.prototype={push:function(a){this.content.push(a);this.sinkDown(this.content.length-1)},pop:function(){var a=this.content[0],c=this.content.pop();0<this.content.length&&(this.content[0]=c,this.bubbleUp(0));return a},remove:function(a){var c=this.content.indexOf(a),d=this.content.pop();c!==this.content.length-1&&(this.content[c]=d,this.scoreFunction(d)<this.scoreFunction(a)?this.sinkDown(c):this.bubbleUp(c))},size:function(){return this.content.length},rescoreElement:function(a){this.sinkDown(this.content.indexOf(a))},
sinkDown:function(a){for(var c=this.content[a];0<a;){var d=(a+1>>1)-1,b=this.content[d];if(this.scoreFunction(c)<this.scoreFunction(b))this.content[d]=c,this.content[a]=b,a=d;else break}},bubbleUp:function(a){for(var c=this.content.length,d=this.content[a],b=this.scoreFunction(d);;){var e=a+1<<1,f=e-1,g=null;if(f<c){var i=this.scoreFunction(this.content[f]);i<b&&(g=f)}if(e<c&&this.scoreFunction(this.content[e])<(null===g?b:i))g=e;if(null!==g)this.content[a]=this.content[g],this.content[g]=d,a=g;else break}}};
var astar={init:function(a){for(var c=0,d=a.length;c<d;c++)for(var b=0,e=a[c].length;b<e;b++){var f=a[c][b];f.f=0;f.g=0;f.h=0;f.visited=!1;f.closed=!1;f.debug="";f.parent=null}},search:function(a,c,d,b){astar.init(a);var b=b||astar.manhattan,e=new BinaryHeap(function(a){return a.f});for(e.push(c);0<e.size();){c=e.pop();if(c===d){a=c;for(d=[];a.parent;)d.push(a),a=a.parent;return d.reverse()}c.closed=!0;for(var f=astar.neighbors(a,c),g=0,i=f.length;g<i;g++){var h=f[g];if(!h.closed&&!h.isWall()){var j=
c.g+1,k=h.visited;if(!k||j<h.g)h.visited=!0,h.parent=c,h.h=h.h||b(h.pos,d.pos),h.g=j,h.f=h.g+h.h,h.debug="F: "+h.f+"<br />G: "+h.g+"<br />H: "+h.h,k?e.rescoreElement(h):e.push(h)}}}return[]},manhattan:function(a,c){var d=Math.abs(c.x-a.x),b=Math.abs(c.y-a.y);return d+b},neighbors:function(a,c){var d=[],b=c.x,e=c.y;a[b-1]&&a[b-1][e]&&d.push(a[b-1][e]);a[b+1]&&a[b+1][e]&&d.push(a[b+1][e]);a[b]&&a[b][e-1]&&d.push(a[b][e-1]);a[b]&&a[b][e+1]&&d.push(a[b][e+1]);return d}};
